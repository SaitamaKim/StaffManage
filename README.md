<center style= "font-size:40px">大三上项目实训</center>
##### 实习题目 ：

基于web的职员人事系统  

##### 功能要求 :

系统具有三类用户：管理员、员工和主管   

+ 管理员权限
  1. 批量导入员工绩效
  2. 批量导入主管信息，添加主管信息
+ 主管权限
  1. 绩效录入
  2. 打印绩效
  3. 导出绩效
+ 员工权限
  1. 查看个人信息
  2. 密码修改
  3. 查看绩效

##### 需求分析

1. 用户分为三个身份，针对三个身份有不同的界面显示，且对应不同的功能
2. 管理员应具有导入excel且可以在线编辑并提交的功能
3. 主管应该可以在线编辑本部门员工的绩效
4. 员工可以查看自己的信息和绩效，且可以修改密码
5. 系统环境要求： 任意操作系统，推荐使用pc版chrome浏览器
6. 运行要求：无特殊要求

##### 软件设计与实现  

由于是合作任务，所以先介绍一下我的任务。我的任务主要围绕在后端，同时也做了一些前端的JS相关的函数编写，下面介绍一下我的设计实现过程：

+ 管理员导入绩效和主管操作：点击上传文件之后，我的想法是让excel文件可以在线显示出来，可以供管理员继续在线修改，修改无误了之后再点击提交。

  	1. 解析excel显示于html页面中，我使用了JS的一个库**_xlsx.core.min.js_**，这个库可以用来解析		excel文件。通过这个库我把excel文件转换为**JSON**格式，然后通过把JSON数据循环放入表	 	格当中，就形成了在线编辑的状态。
 	2. 点击提交之后，我会把表格中修改过或者没修改过的数据再次进行解析。先通过**JS**将数据解析成JSON，再把JSON对象转换成JSON字符串，通过虚拟表单提交到后台（本页面）
      	3. 本页面接收到上一步发来的消息，通过内置request对象获取到JSON字符串。这里由于要用**JAVA处理JSON**，所以我就导入了一个jar包，是阿里巴巴的***FastJson***,通过fastjson中的类与方法 ，我处理了json文件，并且通过和数据库数据的比对，选择对这些数据的插入还是更新
         	4. 由于后台处理写在了本页面，所以载入该页面时需要通过request对象是否包含jsonString这个变量来判断是否需要提交数据。

+ 主管可以绩效录入和打印绩效以及导出绩效。
  	
   1. 主管进入绩效录入界面，首先会查询数据库，通过对本部门员工的查询，动态的放入网页当中。
   2. 当主管点击提交，会解析表格数据并处理成json字符串传给后台，具体操作和管理员提交相似
   3. 点击打印按钮，会调用js的**BOM**方法**window.print()**，打印页面。
4. 点击导出绩效，由于涉及到**JAVA处理Excel**，所以我就引用了**apache poi**包，通过这个包，我实现了java对excel的写入。写入excel之后，需要**下载文件**，具体操作就是给响应 设置响应头为下载，然后通过response对象获取一个输出流，把处理完的excel写入response当中，这样就可以实现下载。

+ 员工查看绩效和修改密码。
  1. 点击查看绩效，查找数据库查询到员工本身绩效，再查询部门所有员工绩效计算平均值，比较员工绩效和部门平均，输出不同的内容。
  2. 修改密码，填写信息之后会提交给本页面，本页面通过比对原密码正确性判断数据库操作是否执行。

+ 各个页面之间的通信，我们采取了**Cookies**的方法。所以在加载每个页面的时候，我们都会先判断**Cookies中存储的账号和密码**是否可以登陆。这样做，一是保证了网页的安全性，二是避免了用户重复登陆的麻烦。

   

##### 调试中遇到的一些问题以及缺陷

1. 提交员工绩效，首先把页面信息解析成json**字符串**，而通过表单提交到后台之后显示却是**乱码**，经过查阅相关资料，我发现表单提交时会对字符串进行**unicode编码**，而在后台拿到数据以后我并没有**解码**，因此导致了字符编码的不对应显示乱码。经过对json字符串的**前端编码和后台解码**，我拿到了正确的数据。
2. jsp代码冗余，在10几个jsp文件中，光一模一样声明的语句就占了**100多行**，完全可以提取出来封装复用，但是在这个项目中我们并没去寻找相关的解决方案，也就导致了代码的冗余度比较高。




